import React from 'react';
import { useGameContext } from '../../context/GameContext';
import { useSpinAnimationLogic } from '../../hooks/useSpinAnimationLogic';
import { CenterSection } from '../CenterSection/CenterSection';
// import { DebugPanel } from '../DebugPanel/DebugPanel';
import { DrumSection } from '../DrumSection/DrumSection';
import { GameOverlays } from '../GameOverlays/GameOverlays';
import { Scoreboard } from '../Scoreboard/Scoreboard';
import { SpinAnimation } from '../SpinAnimation/SpinAnimation';

import styles from './GameLayout.module.scss';

export const GameLayout: React.FC = () => {
  const { controller } = useGameContext();
  const { gameData } = controller;

  const {
    isAnimating,
    setIsAnimating,
    animStartPos,
    handleStartSpinning,
    canSpin,
    onRealSpin,
    avatarUrl,
  } = useSpinAnimationLogic();

  return (
    <div className={styles.appContainer}>
      {/* --- ФОНОВЫЕ ЭФФЕКТЫ --- */}
      <div className={`${styles.lightBlob} ${styles.lightGreen}`} />
      <div className={`${styles.lightBlob} ${styles.lightRed}`} />
      <div
        className={`${styles.mask} ${styles.maskTop}`}
        style={{ '--r': '7deg' } as React.CSSProperties}
      >
        <svg
          width="237"
          height="141"
          viewBox="0 0 237 141"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M233.638 59.8914C234.449 59.5702 235.278 60.3459 234.977 61.164C233.411 65.4078 229.59 74.9227 224.999 80.3207C220.372 85.7619 211.479 91.1149 207.673 93.269C206.946 93.6803 207 94.7365 207.783 95.028C209.806 95.7817 213.044 96.8153 215.527 96.7891C217.54 96.7679 219.918 96.041 221.976 95.219C223.007 94.8069 224.081 96.1667 223.344 96.9975C220.051 100.712 214.989 106.063 210.54 109.264C204.092 113.904 193.338 118.052 188.955 119.641C188.169 119.925 188.049 120.981 188.773 121.398C190.354 122.308 192.71 123.544 194.631 124.047C196.167 124.449 198.177 124.58 199.854 124.606C200.838 124.622 201.272 125.857 200.449 126.398C192.698 131.495 168.86 144.859 141.208 137.617C125.012 133.375 103.52 122.339 98.7903 119.858C98.6552 119.788 98.5321 119.755 98.3795 119.751C93.0414 119.594 68.8984 118.677 52.7026 114.435C25.051 107.192 10.825 83.8581 6.56755 75.6159C6.1157 74.7411 7.09957 73.8771 7.96529 74.346C9.43935 75.1444 11.2553 76.0162 12.7918 76.4186C14.7122 76.9216 17.3723 76.9996 19.1957 76.9814C20.0317 76.973 20.4439 75.994 19.8984 75.3604C16.8572 71.8277 9.51771 62.9402 6.17213 55.7353C3.8637 50.764 2.07517 43.6186 1.02537 38.7668C0.790554 37.6815 2.39308 37.0228 3.08982 37.8873C4.48006 39.6124 6.19643 41.4117 7.94088 42.4172C10.0926 43.6574 13.4215 44.3438 15.5543 44.6787C16.3793 44.8082 16.9442 43.9142 16.5123 43.1993C14.2505 39.4559 9.12402 30.4309 7.75797 23.4199C6.40275 16.4644 7.73676 6.29818 8.45265 1.83181C8.59066 0.97079 9.69399 0.701339 10.2431 1.37873C13.7568 5.71305 23.6137 16.9344 36.8033 24.1369C53.0139 32.9891 70.5166 39.8579 84.9195 50.5211C96.814 59.3271 104.935 75.7238 107.695 81.8932C107.961 82.4877 108.706 82.683 109.23 82.2952C114.659 78.2707 129.776 67.9606 144.46 66.1161C162.241 63.8827 180.863 66.476 199.332 66.7071C214.359 66.8952 228.451 61.9467 233.638 59.8914ZM81.382 77.1573C72.4076 65.8356 54.8274 62.6416 50.3403 61.9954C49.7639 61.9124 49.269 62.3458 49.2778 62.9281C49.3383 66.933 50.1102 81.1656 57.8493 88.2203C65.6598 95.3401 83.3227 97.6251 88.2894 98.1387C88.9542 98.2075 89.4669 97.6141 89.31 96.9644C88.408 93.2297 85.5303 82.3907 81.382 77.1573ZM169.443 94.4023C169.736 93.8991 169.517 93.2788 168.974 93.0685C164.746 91.4321 147.858 85.5979 134.485 91.0664C128.304 93.5942 120.483 101.631 117.866 104.444C117.41 104.933 117.566 105.702 118.18 105.968C122.76 107.955 139.275 114.622 149.573 112.245C159.777 109.89 167.427 97.8633 169.443 94.4023Z"
            fill="white"
            stroke="white"
            strokeWidth="2"
            strokeLinejoin="round"
          />
        </svg>
      </div>

      <div
        className={`${styles.mask} ${styles.maskBottom}`}
        style={{ '--r': '0deg' } as React.CSSProperties}
      >
        <svg viewBox="0 0 206 137" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M163.574 12.9316C173.153 6.35031 190.939 1.23352 190.939 1.23352C190.939 1.23352 194.379 12.5684 194.189 20.0061C193.984 28.0121 189.359 39.9231 189.334 39.988C189.368 39.98 194.718 38.7455 197.023 37.4966C199.514 36.1471 203.882 32.4421 203.882 32.4421C203.883 32.4495 204.539 41.6601 203.323 48.2C202.094 54.8138 195.096 66.4152 195.075 66.4501L204.046 63.5436C204.027 63.6768 200.214 90.8091 177.333 99.1041C140.664 112.397 119.863 105.042 119.77 105.01C119.751 105.037 107.233 123.231 69.6808 133.983C46.2647 140.687 27.2529 120.91 27.1895 120.844L36.161 117.937C36.161 117.937 23.6595 112.635 18.7776 107.992C13.9644 103.414 9.10165 95.5843 9.08392 95.5558C9.1161 95.5582 14.8027 95.9944 17.6039 95.6276C20.2121 95.2859 25.2933 93.1362 25.2933 93.1362C25.2677 93.1197 14.511 86.1727 9.64292 79.7979C5.12857 73.8863 1.26856 62.6919 1.2666 62.6863C1.32487 62.6652 18.693 56.4004 30.2918 56.1145C38.9798 55.9004 52.3667 58.8448 52.4215 58.8568C52.4889 58.8232 66.8233 51.6672 76.7711 50.9677C87.5619 50.2091 103.945 56.292 103.992 56.3095C104.045 56.2299 113.735 41.7257 122.908 36.0196C131.396 30.7402 147.258 28.1305 147.258 28.1305C147.32 28.0601 156.422 17.8462 163.574 12.9316ZM80.8159 76.5628C67.7924 74.7692 43.7463 84.3209 43.6861 84.3448C43.7185 84.3884 56.0551 100.973 68.2354 103.297C82.1884 105.958 104.12 91.6703 104.12 91.6703C104.09 91.6336 93.3502 78.2891 80.8159 76.5628ZM169.28 43.6531C169.28 43.6531 144.151 50.0222 134.641 59.1236C125.508 67.866 124.629 84.9548 124.625 85.0267C124.73 85.0215 150.787 83.7181 160.508 73.4007C169.023 64.3638 169.28 43.6531 169.28 43.6531Z"
            fill="white"
          />
        </svg>
      </div>

      {/* 1. Анимация персонажа */}
      {isAnimating && (
        <SpinAnimation
          avatarUrl={avatarUrl}
          isAnimating={isAnimating}
          startPos={animStartPos}
          onSpinStart={onRealSpin}
          onAnimationEnd={() => setIsAnimating(false)}
        />
      )}

      {/* 2. Все модалки и оверлеи */}
      <GameOverlays />

      {/* 3. Основной интерфейс */}

      <div className={styles.scoreboardLayer}>
        <Scoreboard
          players={gameData.players}
          activePlayerIndex={gameData.activePlayerIndex}
          eliminatedIndices={gameData.eliminatedPlayers}
        />
      </div>

      <DrumSection canSpin={canSpin} onSpinClick={handleStartSpinning} />

      <CenterSection />
      {/* это только ради удобного тестирования, в проде такого быть не должно */}
      {/* <DebugPanel /> */}
    </div>
  );
};
